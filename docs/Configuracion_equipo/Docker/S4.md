# S4 – Microservicio de Carga (Upload)

## Objetivo de S4
Configuramos el servidor S4 como un microservicio especializado exclusivamente en la gestión de subidas. A diferencia de S2 y S3, que son de lectura, S4 recibe las peticiones POST del formulario de extagram.php (redirigidas por S1), procesa las imágenes, las guarda en el volumen físico compartido y registra los metadatos en la base de datos S7.

Esta separación permite que el proceso de subida (que es más pesado en recursos) no afecte al rendimiento del feed principal de los usuarios.

## Configuración y Funcionamiento de S4
- **Despliegue del Contenedor:** Este nodo destaca por tener montado el volumen de imágenes en modo lectura/escritura (rw). Está conectado a las tres redes para poder recibir el tráfico de S1, guardar fotos en el almacenamiento (hacia S5) y escribir en la BD (S7).
  ```sql
  # Comando de ejecución manual
  docker run -d \
    --name s1-s4-upload-1 \
    --network red_entrada \
    --network red_servicios \
    --network red_datos \
    -v /home/ec2-user/sprint2/S4/src:/var/www/extagram:rw \
    -v /home/ec2-user/sprint2/S5/storage:/var/www/extagram/uploads:rw \
    php:8.2-fpm-alpine
  ```
- **Estructura del contenedor:**
  ```sql
  S4/
  └── src/
      └── upload.php  # Lógica de validación, guardado físico y registro SQL    
  ```
  | Fichero | Función Técnica |
  |--------|------|
  | upload.php | Gestor de Persistencia: Valida la imagen, genera un nombre único, la mueve a la carpeta /uploads y ejecuta el INSERT en S7. |

- **Contenido de ficheros:**
